<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive Admin | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-deep: #020617;
            --accent-glow: rgba(99, 102, 241, 0.15);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep);
            color: #f8fafc;
            overflow-x: hidden;
        }

        /* Dégradé signature de la page principale */
        .text-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Effet Glassmorphism */
        .glass-card {
            background: rgba(15, 23, 42, 0.3);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            border-color: rgba(99, 102, 241, 0.3);
            background: rgba(15, 23, 42, 0.5);
            box-shadow: 0 0 40px var(--accent-glow);
            transform: translateY(-2px);
        }

        /* Barre latérale */
        .sidebar-item {
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #818cf8;
        }

        .sidebar-item.active::after {
            content: '';
            position: absolute;
            left: 0;
            top: 25%;
            height: 50%;
            width: 4px;
            background: #6366f1;
            border-radius: 0 4px 4px 0;
            box-shadow: 0 0 10px #6366f1;
        }

        /* Bouton dégradé */
        .btn-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            transition: all 0.3s ease;
        }

        .btn-gradient:hover {
            filter: brightness(1.15);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
            transform: scale(1.02);
        }

        .input-dark {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .input-dark:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
            outline: none;
        }

        /* Animations */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-slide {
            animation: slideUp 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen flex overflow-hidden">

    <!-- Écran de Connexion (Superposé) -->
    <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-[#020617] p-4">
        <div class="max-w-md w-full glass-card p-10 rounded-3xl text-center border-white/10">
            <div class="mb-8">
                <div class="w-16 h-16 mx-auto bg-indigo-600/20 rounded-2xl flex items-center justify-center mb-4">
                    <i class="fas fa-shield-halved text-3xl text-indigo-500"></i>
                </div>
                <h1 class="text-3xl font-bold tracking-tight">Accès Maître</h1>
                <p class="text-slate-400 mt-2">Veuillez entrer la clé de sécurité</p>
            </div>
            
            <div class="space-y-4">
                <input type="password" id="auth_key" placeholder="••••••••" 
                    class="w-full p-4 rounded-xl input-dark text-center text-xl tracking-[0.3em]">
                <button onclick="authenticate()" class="w-full btn-gradient py-4 rounded-xl font-bold text-sm uppercase tracking-widest">
                    Déverrouiller le Panel
                </button>
            </div>
        </div>
    </div>

    <!-- Interface Principale -->
    <div id="main-panel" class="hidden flex w-full h-screen">
        
        <!-- Sidebar -->
        <aside class="w-72 border-r border-white/5 bg-[#030712] flex flex-col">
            <div class="p-8">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center">
                        <i class="fas fa-database text-xs text-white"></i>
                    </div>
                    <span class="font-extrabold text-xl tracking-tighter">ARCHIVE<span class="text-indigo-500">.</span></span>
                </div>
            </div>

            <nav class="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                <button onclick="showPage('overview')" class="sidebar-item active w-full flex items-center gap-3 p-4 rounded-xl text-sm font-semibold">
                    <i class="fas fa-chart-pie opacity-60"></i> Vue d'ensemble
                </button>
                <button onclick="showPage('requests')" class="sidebar-item w-full flex items-center justify-between p-4 rounded-xl text-sm font-semibold">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-paper-plane opacity-60"></i> Requêtes
                    </div>
                    <span id="notif-count" class="bg-indigo-600 text-[10px] px-2 py-0.5 rounded-full hidden">0</span>
                </button>
                <button onclick="showPage('import')" class="sidebar-item w-full flex items-center gap-3 p-4 rounded-xl text-sm font-semibold">
                    <i class="fas fa-file-import opacity-60"></i> Import de masse
                </button>
                <div class="pt-4 pb-2 px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest">Gestion</div>
                <button onclick="showPage('users')" class="sidebar-item w-full flex items-center gap-3 p-4 rounded-xl text-sm font-semibold">
                    <i class="fas fa-users opacity-60"></i> Utilisateurs
                </button>
            </nav>

            <div class="p-6 border-t border-white/5">
                <button onclick="location.reload()" class="flex items-center gap-2 text-slate-500 hover:text-white transition text-xs font-medium mx-auto">
                    <i class="fas fa-sign-out-alt"></i> Fermer la session
                </button>
            </div>
        </aside>

        <!-- Zone de Contenu -->
        <main class="flex-1 overflow-y-auto bg-[#020617] p-8 md:p-12">
            
            <!-- Page: Overview -->
            <div id="page-overview" class="page-content animate-slide">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-12">
                    <div>
                        <h2 class="text-4xl font-black tracking-tight">Tableau de <span class="text-gradient">Bord</span></h2>
                        <p class="text-slate-400 mt-1">Gestion centralisée de vos ressources IA.</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="glass-card px-4 py-2 rounded-xl flex items-center gap-3">
                            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                            <span class="text-xs font-bold uppercase tracking-wider text-slate-300">Système Online</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="glass-card p-6 rounded-3xl">
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mb-2">Total Bots</p>
                        <h3 id="stat-total" class="text-5xl font-black">--</h3>
                    </div>
                    <div class="glass-card p-6 rounded-3xl">
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mb-2">En Attente</p>
                        <h3 id="stat-pending" class="text-5xl font-black text-indigo-400">--</h3>
                    </div>
                    <div class="glass-card p-6 rounded-3xl">
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mb-2">Mises à jour</p>
                        <h3 class="text-5xl font-black text-cyan-400">2.4</h3>
                    </div>
                </div>

                <div class="glass-card rounded-3xl overflow-hidden border-white/10">
                    <div class="p-6 border-b border-white/5 bg-white/[0.02] flex justify-between items-center">
                        <h4 class="font-bold flex items-center gap-2">
                            <i class="fas fa-list-ul text-indigo-500 text-sm"></i> Bibliothèque Active
                        </h4>
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-xs"></i>
                            <input type="text" placeholder="Rechercher..." class="pl-9 pr-4 py-2 rounded-lg input-dark text-xs w-64">
                        </div>
                    </div>
                    <div id="approved-list" class="divide-y divide-white/5">
                        <!-- Les items approuvés seront injectés ici -->
                        <div class="p-12 text-center text-slate-500 italic">Chargement des données...</div>
                    </div>
                </div>
            </div>

            <!-- Page: Requests -->
            <div id="page-requests" class="page-content hidden animate-slide">
                <div class="mb-12">
                    <h2 class="text-4xl font-black tracking-tight">Requêtes en <span class="text-gradient">Attente</span></h2>
                    <p class="text-slate-400 mt-1">Vérifiez et validez les soumissions de la communauté.</p>
                </div>
                <div id="pending-list" class="grid grid-cols-1 gap-4">
                    <!-- Les suggestions seront injectées ici -->
                </div>
            </div>

            <!-- Page: Import -->
            <div id="page-import" class="page-content hidden animate-slide">
                <div class="mb-12">
                    <h2 class="text-4xl font-black tracking-tight">Importation <span class="text-gradient">Flash</span></h2>
                    <p class="text-slate-400 mt-1">Injectez des données au format JSON pour un déploiement rapide.</p>
                </div>
                <div class="glass-card p-8 rounded-3xl">
                    <textarea id="bulk-json" class="w-full h-80 rounded-2xl p-6 input-dark font-mono text-sm mb-6" 
                        placeholder='[{"name": "...", "url": "...", "category": "..."}]'></textarea>
                    <div class="flex justify-end">
                        <button onclick="processBulk()" class="btn-gradient px-12 py-4 rounded-xl font-bold uppercase tracking-widest text-sm">
                            Lancer l'importation
                        </button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        let sessionKey = "";

        // Navigation simple
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-' + pageId).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // Authentification simulée (à lier avec ton API)
        async function authenticate() {
            sessionKey = document.getElementById('auth_key').value;
            if(!sessionKey) return alert("Veuillez entrer une clé.");

            // Ici tu devrais faire un appel à ton API pour vérifier la clé
            // Pour l'exemple, on affiche l'interface
            document.getElementById('auth-screen').classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-panel').classList.remove('hidden');
                refreshData();
            }, 300);
        }

        // Rafraîchir les données
        async function refreshData() {
            try {
                const resApp = await fetch('/api/manage?type=approved');
                const resPen = await fetch('/api/manage?type=pending');
                
                const approved = await resApp.json();
                const pending = await resPen.json();

                // Mise à jour Stats
                document.getElementById('stat-total').innerText = approved.length;
                document.getElementById('stat-pending').innerText = pending.length;
                
                const badge = document.getElementById('notif-count');
                if(pending.length > 0) {
                    badge.innerText = pending.length;
                    badge.classList.remove('hidden');
                }

                // Rendu liste approuvée
                const approvedContainer = document.getElementById('approved-list');
                approvedContainer.innerHTML = approved.map(item => `
                    <div class="flex items-center justify-between p-5 hover:bg-white/[0.03] transition group">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-xl bg-indigo-500/10 flex items-center justify-center text-indigo-400 font-bold border border-indigo-500/20">
                                ${item.name.charAt(0)}
                            </div>
                            <div>
                                <h5 class="font-bold text-sm">${item.name}</h5>
                                <span class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">${item.category}</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition">
                            <button class="p-2 text-slate-500 hover:text-white"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteBot('${item.name}')" class="p-2 text-slate-500 hover:text-red-500"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                `).join('') || '<div class="p-10 text-center opacity-30 italic">Aucun bot actif</div>';

                // Rendu requêtes en attente
                const pendingContainer = document.getElementById('pending-list');
                pendingContainer.innerHTML = pending.map(item => `
                    <div class="glass-card p-6 rounded-2xl flex flex-col md:flex-row items-center justify-between gap-6 border-l-4 border-l-indigo-500">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-xl font-black">${item.name}</span>
                                <span class="px-2 py-0.5 rounded-md bg-indigo-500/20 text-indigo-400 text-[10px] font-bold uppercase tracking-tighter">${item.category}</span>
                            </div>
                            <p class="text-sm text-slate-400 italic mb-3">"${item.desc}"</p>
                            <a href="${item.url}" target="_blank" class="text-xs text-indigo-400 hover:underline flex items-center gap-1">
                                <i class="fas fa-link"></i> Voir la source
                            </a>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="approveBot(${item.id})" class="btn-gradient px-6 py-3 rounded-xl text-xs font-bold uppercase tracking-widest">Approuver</button>
                            <button class="bg-white/5 hover:bg-red-500/20 text-slate-400 hover:text-red-500 px-6 py-3 rounded-xl text-xs font-bold uppercase tracking-widest transition">Refuser</button>
                        </div>
                    </div>
                `).join('') || '<div class="py-20 text-center opacity-20"><i class="fas fa-inbox text-5xl mb-4"></i><p>Aucune requête en attente</p></div>';

            } catch (err) {
                console.error("Erreur de chargement:", err);
            }
        }

        // Actions API
        async function apiPost(action, data) {
            const res = await fetch('/api/manage', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action, data, password: sessionKey })
            });
            if(!res.ok) alert("Erreur: Vérifiez votre clé d'accès.");
            return res.json();
        }

        async function approveBot(id) { await apiPost('approve', { id }); refreshData(); }
        async function deleteBot(name) { if(confirm("Supprimer définitivement ?")) { await apiPost('delete', { name }); refreshData(); } }
        
        async function processBulk() {
            const area = document.getElementById('bulk-json');
            try {
                const data = JSON.parse(area.value);
                for(let b of data) { await apiPost('add_direct', b); }
                alert("Importation réussie !");
                area.value = "";
                refreshData();
            } catch(e) { alert("Format JSON invalide."); }
        }
    </script>
</body>
</html>

