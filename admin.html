<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin | Contrôle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020408; }
        .sidebar { background: #0a0c12; border-right: 1px solid rgba(255, 255, 255, 0.05); }
        .card-admin { background: #0f111a; border: 1px solid rgba(255, 255, 255, 0.03); }
        .input-admin { background: #05070a; border: 1px solid rgba(255, 255, 255, 0.08); }
        .input-admin:focus { border-color: #6366f1; box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1); outline: none; }
    </style>
</head>
<body class="text-slate-300 min-h-screen flex items-center justify-center">

    <!-- Écran de Verrouillage Design -->
    <div id="login-screen" class="fixed inset-0 bg-black z-50 flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="text-center mb-10">
                <div class="size-20 bg-indigo-600 rounded-[2rem] mx-auto mb-6 flex items-center justify-center shadow-2xl shadow-indigo-600/40 rotate-12">
                    <i class="fas fa-shield-alt text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-black text-white mb-2">Accès Restreint</h1>
                <p class="text-slate-500">Veuillez vous authentifier pour continuer.</p>
            </div>
            <div class="bg-slate-900/50 p-8 rounded-[2.5rem] border border-white/5 backdrop-blur-xl">
                <input type="password" id="adminPass" placeholder="••••••••" class="w-full input-admin p-5 rounded-2xl mb-4 text-center text-xl tracking-widest text-white">
                <button onclick="checkAuth()" class="w-full bg-indigo-600 py-5 rounded-2xl font-black text-white hover:bg-indigo-500 transition-all shadow-lg shadow-indigo-600/20 active:scale-95">
                    ENTRER DANS LE PANEL
                </button>
            </div>
        </div>
    </div>

    <!-- Interface Dashboard -->
    <div id="admin-content" class="hidden w-full min-h-screen flex flex-col lg:flex-row">
        <!-- Sidebar -->
        <aside class="sidebar w-full lg:w-72 p-8 flex flex-col">
            <div class="flex items-center gap-3 mb-12">
                <div class="size-8 bg-red-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-terminal text-white text-xs"></i>
                </div>
                <span class="font-black text-white tracking-tighter">ADMIN.HQ</span>
            </div>
            
            <nav class="space-y-2 flex-grow">
                <a href="#" class="flex items-center gap-3 bg-indigo-600/10 text-indigo-400 p-4 rounded-xl font-bold">
                    <i class="fas fa-th-large"></i> Vue d'ensemble
                </a>
            </nav>

            <button onclick="location.reload()" class="mt-auto flex items-center gap-3 text-slate-500 hover:text-white p-4 font-bold transition">
                <i class="fas fa-sign-out-alt"></i> Déconnexion
            </button>
        </aside>

        <!-- Main Content -->
        <main class="flex-grow p-6 lg:p-12 overflow-y-auto">
            <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-12">
                <div>
                    <h2 class="text-3xl font-black text-white">Gestion du Catalogue</h2>
                    <p class="text-slate-500">Validez les suggestions ou ajoutez des bots manuellement.</p>
                </div>
            </header>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-10">
                <!-- Suggestions -->
                <div class="card-admin p-8 rounded-[2rem]">
                    <h3 class="text-xl font-bold mb-8 flex items-center gap-3">
                        <span class="size-2 bg-indigo-500 rounded-full shadow-[0_0_10px_#6366f1]"></span>
                        Files d'attente
                    </h3>
                    <div id="suggestions-list" class="space-y-4">
                        <!-- JS -->
                    </div>
                </div>

                <!-- Ajout Manuel -->
                <div class="space-y-8">
                    <div class="card-admin p-8 rounded-[2rem]">
                        <h3 class="text-xl font-bold mb-6">Ajout Express</h3>
                        <form id="directAddForm" class="space-y-4">
                            <input type="text" id="d-name" placeholder="Nom du bot" required class="w-full input-admin p-4 rounded-xl text-white">
                            <input type="url" id="d-url" placeholder="URL GitHub" required class="w-full input-admin p-4 rounded-xl text-white">
                            <textarea id="d-desc" placeholder="Description courte" required class="w-full input-admin p-4 rounded-xl h-24 text-white"></textarea>
                            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-500 py-4 rounded-xl font-bold text-white transition shadow-lg shadow-indigo-600/20">
                                PUBLIER MAINTENANT
                            </button>
                        </form>
                    </div>

                    <div class="card-admin p-8 rounded-[2rem]">
                        <h3 class="text-xl font-bold mb-6">Bots en ligne</h3>
                        <div id="published-list" class="space-y-3 max-h-64 overflow-y-auto pr-2">
                            <!-- JS -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const STORAGE_KEY = 'approved_bots_v2';
        const SUGGEST_KEY = 'pending_suggestions_v2';
        const HASHED_SECRET = "240be518ebb87208f7188b3a95d0ce8333e330a1306b8258529f7833a6138980";

        function checkAuth() {
            const pass = document.getElementById('adminPass').value;
            const hashedInput = CryptoJS.SHA256(pass).toString();
            
            if (hashedInput === HASHED_SECRET) {
                document.getElementById('login-screen').classList.add('hidden');
                document.body.classList.remove('flex', 'items-center', 'justify-center');
                document.getElementById('admin-content').classList.remove('hidden');
                loadData();
            } else {
                alert("Identifiants incorrects.");
            }
        }

        function loadData() {
            const suggestions = JSON.parse(localStorage.getItem(SUGGEST_KEY)) || [];
            const published = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

            // Render Suggestions
            const sList = document.getElementById('suggestions-list');
            sList.innerHTML = suggestions.length ? suggestions.map(s => `
                <div class="bg-black/40 border border-white/5 p-6 rounded-2xl group hover:border-indigo-500/30 transition">
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-bold text-white">${s.name}</h4>
                        <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                            <button onclick="approve(${s.id})" class="size-9 bg-green-500/10 text-green-500 rounded-lg hover:bg-green-500 hover:text-white transition flex items-center justify-center"><i class="fas fa-check"></i></button>
                            <button onclick="reject(${s.id})" class="size-9 bg-red-500/10 text-red-500 rounded-lg hover:bg-red-500 hover:text-white transition flex items-center justify-center"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <p class="text-sm text-slate-500 mb-2 truncate">${s.url}</p>
                    <p class="text-sm text-slate-400 line-clamp-2">${s.desc}</p>
                </div>
            `).join('') : '<div class="text-center py-10 text-slate-600 italic">Rien à signaler.</div>';

            // Render Published
            const pList = document.getElementById('published-list');
            pList.innerHTML = published.map(p => `
                <div class="flex justify-between items-center bg-black/40 p-4 rounded-xl border border-white/5">
                    <span class="text-sm font-semibold text-white">${p.name}</span>
                    <button onclick="removePublished('${p.name}')" class="text-red-500 hover:text-red-400 text-xs font-bold uppercase tracking-wider">Supprimer</button>
                </div>
            `).join('');
        }

        function approve(id) {
            let suggestions = JSON.parse(localStorage.getItem(SUGGEST_KEY));
            let published = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            const bot = suggestions.find(s => s.id === id);
            published.push(bot);
            suggestions = suggestions.filter(s => s.id !== id);
            localStorage.setItem(SUGGEST_KEY, JSON.stringify(suggestions));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(published));
            loadData();
        }

        function reject(id) {
            let suggestions = JSON.parse(localStorage.getItem(SUGGEST_KEY));
            suggestions = suggestions.filter(s => s.id !== id);
            localStorage.setItem(SUGGEST_KEY, JSON.stringify(suggestions));
            loadData();
        }

        function removePublished(name) {
            if(!confirm(`Supprimer définitivement ${name} ?`)) return;
            let published = JSON.parse(localStorage.getItem(STORAGE_KEY));
            published = published.filter(p => p.name !== name);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(published));
            loadData();
        }

        document.getElementById('directAddForm').onsubmit = (e) => {
            e.preventDefault();
            let published = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            published.push({
                id: Date.now(),
                name: document.getElementById('d-name').value,
                url: document.getElementById('d-url').value,
                desc: document.getElementById('d-desc').value
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(published));
            e.target.reset();
            loadData();
            alert("Publié avec succès !");
        };
    </script>
</body>
</html>

